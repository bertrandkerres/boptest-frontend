openapi: 3.0.3
info:
  title: BOPTEST Service API
  description: A REST API for emulating buildings for testing control systems.
  version: 1.0.0
servers:
  - url: http://127.0.0.1:5000
    description: Local server
components:
  schemas:
    BoundedSignalMeta:
      type: object
      properties:
        Description:
          type: string
          description: Description of the signal.
        Maximum:
          type: number
          nullable: true
          description: Maximum value of the signal.
        Minimum:
          type: number
          nullable: true
          description: Minimum value of the signal.
        Unit:
          type: string
          nullable: true
          description: Unit of the signal.
    SignalMeta:
      type: object
      properties:
        Description:
          type: string
          description: Description of the signal.
        Unit:
          type: string
          nullable: true
          description: Unit of the signal.
    BoundedSignalMetaResponse:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/BoundedSignalMeta'
    SignalMetaResponse:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/SignalMeta'
    ForecastQuery:
      type: object
      properties:
        point_names:
          type: array
          items:
            type: string
          description: List of point names.
        horizon:
          type: number
          description: Forecast horizon in seconds.
        interval:
          type: number
          description: Time interval between forecast points in seconds.
    ResultsQuery:
      type: object
      properties:
        point_names:
          type: array
          items:
            type: string
          description: List of point names.
        start_time:
          type: number
          description: Start time of the results query (epoch time).
        final_time:
          type: number
          description: Final time of the results query (epoch time).
    TimeSeries:
      type: object
      additionalProperties:
        type: array
        items:
          type: number
paths:
  /inputs:
    get:
      summary: Get metadata for inputs
      description: Returns metadata for input signals.
      responses:
        '200':
          description: Successful response with metadata for inputs.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BoundedSignalMetaResponse'
  /measurements:
    get:
      summary: Get metadata for measurements
      description: Returns metadata for measurement signals.
      responses:
        '200':
          description: Successful response with metadata for measurements.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BoundedSignalMetaResponse'
  /forecast_points:
    get:
      summary: Get metadata for forecast points
      description: Returns metadata for forecast point signals.
      responses:
        '200':
          description: Successful response with metadata for forecast points.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignalMetaResponse'
  /forecast:
    put:
      summary: Submit a forecast query
      description: Sends a ForecastQuery payload and returns a TimeSeries response.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForecastQuery'
      responses:
        '200':
          description: Successful response with forecast time series.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeSeries'
  /results:
    put:
      summary: Submit a results query
      description: Sends a ResultsQuery payload and returns a TimeSeries response.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResultsQuery'
      responses:
        '200':
          description: Successful response with results time series.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TimeSeries'
  /advance:
    post:
      summary: Advance the simulation
      description: Advances the simulation with optional input overwrites. The payload can include input values and activation flags for overwriting.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties:
                oneOf:
                  - type: number
                    description: Input value to overwrite.
                  - type: integer
                    enum: [0, 1]
                    description: Activation flag (1 to enable overwrite, 0 to disable).
      responses:
        '200':
          description: Successful response with simulation advancement results.
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: number
                  description: Resulting values after advancing the simulation.
  /step:
    get:
      summary: Get the simulation time step
      description: Returns the time step used in the simulation.
      responses:
        '200':
          description: Successful response with the time step.
          content:
            application/json:
              schema:
                type: number
                description: The time step used in the simulation.
    put:
      summary: Set the simulation time step
      description: Sets the time step used in the simulation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                step:
                  type: number
                  description: The new time step to set for the simulation.
      responses:
        '200':
          description: Successful response indicating the time step was updated.
          content:
            application/json:
              schema:
                type: string
                description: Confirmation message.
  /scenario:
    get:
      summary: Get the current scenario description
      description: Returns a description of the current scenario.
      responses:
        '200':
          description: Successful response with the scenario description.
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
                  description: Key-value pairs describing the current scenario.
  /kpi:
    get:
      summary: Get the Key Performance Indicators (KPIs)
      description: Returns the KPIs as calculated by the emulator.
      responses:
        '200':
          description: Successful response with the KPIs.
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: number
                  description: Key-value pairs of KPI names and their values.
  /initialize:
    put:
      summary: Initialize the simulation
      description: Initializes the simulation with a start time and warmup period.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                start_time:
                  type: number
                  description: The start time of the simulation (epoch time).
                warmup_period:
                  type: number
                  description: The warmup period for the simulation in seconds.
      responses:
        '200':
          description: Successful response indicating the simulation was initialized.
          content:
            application/json:
              schema:
                type: string
                description: Confirmation message.
